<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مساعدك الشخصي للتغلب على القلق (نسخة Pro)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            scroll-behavior: smooth;
        }
        .prose {
            max-width: 100%;
        }
        .card {
            background-color: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            border: 1px solid #e5e7eb;
        }
        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 16px;
        }
        .card-icon {
            width: 32px;
            height: 32px;
            flex-shrink: 0;
            color: #4f46e5;
        }
        .btn-primary {
            background-color: #4f46e5;
            color: white;
            font-weight: 600;
            padding: 12px 24px;
            border-radius: 8px;
            transition: background-color 0.3s ease;
            cursor: pointer;
            border: none;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        .loader {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #aiResponseContainer {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin-top: 24px;
            animation: fadeIn 0.5s ease-in-out;
        }
        #aiResponseContainer h3 {
            font-size: 1.2rem;
            font-weight: bold;
            color: #111827;
            border-bottom: 2px solid #4f46e5;
            padding-bottom: 8px;
            margin-bottom: 16px;
        }
        #aiResponseContainer p, #aiResponseContainer li {
            font-size: 1rem;
            line-height: 1.8;
            color: #374151;
        }
         #aiResponseContainer strong {
            color: #1f2937;
         }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">

        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900">مساعدك للتغلب على القلق (نسخة Pro)</h1>
            <p class="mt-4 text-lg text-gray-600">أداة تفاعلية مبنية على حكمة "ديل كارنيجي" لمواجهة تحديات الحياة بطمأنينة وثقة.</p>
        </header>

        <!-- Interactive AI Assistant -->
        <div class="card mb-8" id="ai-assistant">
            <div class="card-header">
                <svg class="card-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 002.25-2.25V6.75a2.25 2.25 0 00-2.25-2.25H6.75A2.25 2.25 0 004.5 6.75v10.5a2.25 2.25 0 002.25 2.25zm.75-12h9v9h-9v-9z" /></svg>
                <span>المساعد الذكي: أحتاج مساعدة فورية</span>
            </div>
            <p class="text-gray-600 mb-4">صف المشكلة التي تسبب لك القلق حالياً، وسيقوم المساعد الذكي بتحليلها وتقديم خطة عمل مخصصة لك بناءً على قواعد ديل كارنيجي.</p>
            
            <div class="mb-4">
                <label for="apiKeyInput" class="block mb-2 text-sm font-medium text-gray-900">مفتاح Gemini API الخاص بك:</label>
                <input type="text" id="apiKeyInput" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5" placeholder="أدخل مفتاح الـ API هنا" required>
                <p class="mt-1 text-xs text-gray-500">مفتاحك ضروري لعمل المساعد الذكي. سيتم حفظه في متصفحك فقط.</p>
            </div>
            
            <textarea id="userInput" rows="5" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="مثال: أنا قلق جدًا بشأن عرض تقديمي مهم في العمل الأسبوع القادم، وأخشى أن أفشل..."></textarea>
            
            <button id="getHelpButton" class="btn-primary w-full mt-4">
                <span id="buttonText">احصل على خطة عمل</span>
            </button>

            <div id="loaderContainer" class="hidden text-center mt-4">
                <div class="loader"></div>
                <p class="text-gray-600">يقوم المساعد الذكي بتحليل مشكلتك...</p>
            </div>

            <div id="aiResponseContainer" class="hidden prose">
                 <!-- AI response will be injected here -->
            </div>
        </div>

        <!-- Comprehensive Action Plan -->
        <div class="card">
            <div class="card-header">
                <svg class="card-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="color: #3b82f6;"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>
                <span>خطة العمل الكاملة (جميع القواعد)</span>
            </div>
            
            <div class="space-y-6">
                <!-- Content remains the same as previous version -->
                <h3 class="font-bold text-lg text-blue-600">المرحلة الأولى: الإسعافات الأولية (عندما يهاجمك القلق)</h3>
                <ul class="list-disc pr-6 mt-2 space-y-2 text-gray-700">
                    <li><strong>عش في حدود يومك:</strong> أغلق الأبواب الحديدية على الماضي والمستقبل. ركز فقط على مهام اليوم حتى وقت النوم.</li>
                    <li><strong>انشغل بالعمل فوراً:</strong> قم بأي نشاط يتطلب تركيزاً. العقل المشغول لا يجد وقتاً للقلق.</li>
                </ul>
                <h3 class="font-bold text-lg text-blue-600 mt-6">المرحلة الثانية: تحليل المشكلة (عندما تهدأ)</h3>
                <ul class="list-disc pr-6 mt-2 space-y-2 text-gray-700">
                    <li><strong>واجه أسوأ الاحتمالات (طريقة كاريير):</strong> <ol class="list-decimal pr-6 mt-1"><li>اسأل: ما هو أسوأ ما يمكن أن يحدث؟</li><li>هيئ نفسك لقبول هذا الأسوأ إذا لزم الأمر.</li><li>ابدأ في تحسين الموقف انطلاقاً من هذا القبول.</li></ol></li>
                    <li><strong>حلل المشكلة بالحقائق:</strong> <ol class="list-decimal pr-6 mt-1"><li>ما هي المشكلة تحديداً؟</li><li>ما هو سببها؟</li><li>ما هي الحلول الممكنة؟</li><li>ما هو أفضل حل؟ (ثم نفذه فوراً).</li></ol></li>
                </ul>
                <h3 class="font-bold text-lg text-blue-600 mt-6">المرحلة الثالثة: الوقاية وبناء عقلية مضادة للقلق (للمدى الطويل)</h3>
                <ul class="list-disc pr-6 mt-2 space-y-2 text-gray-700">
                    <li><strong>لا تسمح للتوافه بهزيمتك:</strong> الحياة أقصر من أن تُقَصِّرها. ضع "حداً أقصى" للقلق الذي يستحقه أي أمر تافه.</li>
                    <li><strong>استعن بقانون الاحتمالات:</strong> اسأل نفسك: "ما هو احتمال حدوث ما أخشاه حقاً؟". أغلب ما نقلق بشأنه لا يحدث.</li>
                    <li><strong>ارضَ بما ليس منه بد:</strong> لا تضيع طاقتك بمقاومة ما لا يمكن تغييره. تقبّل وتعاون مع الحتمي.</li>
                    <li><strong>لا تحاول نشر النشارة:</strong> الماضي انتهى. لا تبكِ على اللبن المسكوب. تعلم من أخطائك وامضِ قدماً.</li>
                    <li><strong>احصِ نعمك بدلاً من متاعبك:</strong> ركز على ما تملكه، وليس على ما ينقصك.</li>
                    <li><strong>كن أنت، لا تقلد الآخرين:</strong> اعرف نفسك وكن كما خلقك الله. الحسد جهل والتقليد انتحار.</li>
                    <li><strong>عندما تعطيك الحياة ليموناً، اصنع منه شراباً حلواً:</strong> ابحث عن الجانب الإيجابي في كل محنة وحول الخسارة إلى مكسب.</li>
                    <li><strong>لا تنتظر الشكر من أحد:</strong> افعل الخير لأنه الصواب، وليس انتظاراً للامتنان.</li>
                    <li><strong>فكر في السعادة، تجد السعادة:</strong> أفكارنا هي التي تصنع واقعنا. فكر في الشجاعة والقوة والطمأنينة.</li>
                    <li><strong>لا تفكر في الانتقام:</strong> الحقد يؤذي صاحبه أكثر ممن يحقد عليه. لا تضيع وقتك في التفكير في أعدائك.</li>
                </ul>
            </div>
             <p class="mt-8 text-sm text-center text-gray-500 border-t pt-4">تذكر: تطبيق هذه المبادئ يتطلب وقتاً ومثابرة. استخدم هذه الأداة كمرشد عملي يومي لك.</p>
        </div>
    </div>

    <script>
        const getHelpButton = document.getElementById('getHelpButton');
        const userInput = document.getElementById('userInput');
        const apiKeyInput = document.getElementById('apiKeyInput');
        const loaderContainer = document.getElementById('loaderContainer');
        const aiResponseContainer = document.getElementById('aiResponseContainer');
        const buttonText = document.getElementById('buttonText');
        
        // Load API key from localStorage on page load
        document.addEventListener('DOMContentLoaded', () => {
            const savedApiKey = localStorage.getItem('geminiApiKey');
            if (savedApiKey) {
                apiKeyInput.value = savedApiKey;
            }
        });

        getHelpButton.addEventListener('click', async () => {
            const userProblem = userInput.value.trim();
            const apiKey = apiKeyInput.value.trim();

            if (!apiKey) {
                aiResponseContainer.innerHTML = '<h3>خطأ</h3><p>الرجاء إدخال مفتاح Gemini API الخاص بك لتتمكن من استخدام المساعد الذكي.</p>';
                aiResponseContainer.classList.remove('hidden');
                return;
            }
            
            if (!userProblem) {
                aiResponseContainer.innerHTML = '<h3>خطأ</h3><p>الرجاء كتابة المشكلة التي تسبب لك القلق أولاً.</p>';
                aiResponseContainer.classList.remove('hidden');
                return;
            }
            
            // Save API key to localStorage
            localStorage.setItem('geminiApiKey', apiKey);


            loaderContainer.classList.remove('hidden');
            buttonText.classList.add('hidden');
            getHelpButton.disabled = true;
            aiResponseContainer.classList.add('hidden');

            try {
                const systemPrompt = `
                    أنت مساعد خبير وحكيم، متخصص في مساعدة الناس على التغلب على القلق باستخدام مبادئ ديل كارنيجي من كتابه "دع القلق وابدأ الحياة".
                    مهمتك هي تحليل مشكلة المستخدم وتقديم خطة عمل واضحة، منظمة، وعملية، مستوحاة مباشرة من قواعد الكتاب.
                    يجب أن تكون إجابتك متعاطفة، مشجعة، وعملية.
                    
                    اتبع الهيكل التالي بدقة في إجابتك:
                    1.  **بداية متعاطفة:** ابدأ بالاعتراف بمشاعر المستخدم وطمأنته بأن القلق شعور طبيعي يمكن التعامل معه.
                    2.  **تطبيق قاعدة الإسعافات الأولية (عش في حدود يومك):** ذكّر المستخدم بالتركيز على "اليوم" فقط لتقليل الشعور بالإرهاق.
                    3.  **تطبيق طريقة ويليس كاريير (مواجهة أسوأ الاحتمالات):** أرشد المستخدم خطوة بخطوة لتطبيق هذه القاعدة على مشكلته تحديداً.
                        - ما هو أسوأ سيناريو؟
                        - كيف يمكنه تقبل هذا السيناريو نفسياً؟
                        - ما هي الخطوات التي يمكنه اتخاذها الآن لتحسين الوضع؟
                    4.  **تطبيق قاعدة تحليل الحقائق:** شجع المستخدم على جمع الحقائق بموضوعية عبر طرح أسئلة واضحة.
                        - ما هي المشكلة بالضبط؟
                        - ما هي الحقائق المؤكدة حولها (وليس المخاوف)؟
                        - ما هي الخيارات المتاحة؟
                    5.  **دمج قاعدة أو قاعدتين إضافيتين من الكتاب تكونان الأكثر صلة بمشكلة المستخدم.** مثلاً: (لا تسمح للتوافه بهزيمتك)، (احص نعمك)، (اصنع من الليمون شراباً حلواً). اشرح كيف تنطبق هذه القاعدة على حالته.
                    6.  **خاتمة محفزة:** اختتم بخطوة عملية فورية وصغيرة يمكن للمستخدم القيام بها الآن ليشعر بالتحكم، مع رسالة أمل وتشجيع.

                    تحدث دائماً بصيغة المخاطب المباشر ("أنت"، "عليك أن...") لجعل النصيحة شخصية وقابلة للتنفيذ. استخدم تنسيق markdown البسيط (bold) لتوضيح النقاط الهامة.
                `;
                
                // Note: The user requested gemini-2.5-pro-preview-05-20, let's use it.
                const model = 'gemini-2.5-pro-preview-05-20';
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ parts: [{ text: userProblem }] }],
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                };
                
                let response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                     const errorData = await response.json();
                     console.error("API Error:", errorData);
                     throw new Error(`خطأ من الخادم: ${response.status}. تأكد من صحة مفتاح API وصلاحياته.`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates[0].content.parts[0].text) {
                    const aiText = result.candidates[0].content.parts[0].text;
                    
                    let htmlResponse = '<h3>خطة عملك الشخصية للتغلب على القلق</h3>' + aiText
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\n/g, '<br>');

                    aiResponseContainer.innerHTML = htmlResponse;
                    aiResponseContainer.classList.remove('hidden');

                } else {
                     console.error("Unexpected API response structure:", result);
                     if (result.promptFeedback && result.promptFeedback.blockReason) {
                        throw new Error(`تم حظر الطلب لسبب: ${result.promptFeedback.blockReason}.`);
                     }
                    throw new Error('لم يتمكن المساعد الذكي من إنشاء خطة. الرجاء المحاولة مرة أخرى.');
                }

            } catch (error) {
                console.error('Error:', error);
                aiResponseContainer.innerHTML = `<h3>حدث خطأ</h3><p>عذراً، لم نتمكن من معالجة طلبك حالياً. ${error.message}</p>`;
                aiResponseContainer.classList.remove('hidden');
            } finally {
                loaderContainer.classList.add('hidden');
                buttonText.classList.remove('hidden');
                getHelpButton.disabled = false;
            }
        });
    </script>

</body>
</html>
